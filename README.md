# Artificial-intelligence-system
### Курс "Системы искусственного интеллекта" в МГТУ им Баумана

## FAQ по фильтрированному поиску

1. Как запустить?

- Скачиваете [golang](https://golang.org/dl/) версии 1.13 или выше
- Дальше из корневой папки проекта прописываете команду `go run main.go`
- Сайт запустится по адресу [localhost:2997](http://localhost:2997)

2. Как открыть фильтрованный поиск?
- Нажмите на `расширенный поиск`(зеленая кнопка наверху слева под поисковой строкой), откроется 2 панельки. В левой будут двойные ползунки для указания интервалов. В правой панели находятся метки с вариантами типа/возраста/жанров. Кликайте по ним, чтобы убрать/добавить соответсвующий параметр. Если метка засерена, значит все тайтлы, имеющие соответствующий параметр будут исключены из поисковой выдачи.  

3. Как применить фильтры?
- Они применяются автоматически сразу после изменения параметров

4. А что будет, если выставить фильтры так, чтобы ни одного тайтла не нашлось?
- Выведется сообщение: "Нет тайтлов, удовлетворяющих выбранным условиям. Но мы подобрали небольшой список того, что может вам понравиться". А ниже отобразится список рекомендаций на основе запрошенных условий.

5. Как определить, что советовать?
  - Поисковые фильтры делятся на 2 типа:
    - __Постоянные__ - фильтры, которые __запрещено менять__. Например пользователь указал, что хочет смотреть только комедию, система гарантирует, что все рекомендоманные тайтлы будут этого жанра. К фильтрам такого типа относятся: 
        - тип тайтла;
        - возрастной рейтинг;
        - онгоинг;
        - студия;
        - жанр;
        - название.
    - __Плавающие__ - фильтры, рамки которых можно сдвигать, что приводит к появлению рекомендаций:
        - пользовательская оценка;
        - эпизоды;
        - длительность;
        - год выпуска.
  - Принцип плавающих фильтров следующий - их границы раздвигаются с некоторым шагом до тех пор, пока не найдутся тайтлы, удовлетворяющие новым условями:
    - Расчитывается шаг расширения каждого фильтра
    - Запускается цикл:
      - Среди списка тайтлов ищутся те, которые отвечают всем требованиям(напимер рейтинг больше 7 и меньше 9, дата выхода от 2006 от 2020, кол-во серий от 2 до 7)
      - Если найдено хотя бы 1 аниме, выходим из цикла
      - Расширяем все фильтры на вычисленный шаг. Пример: пусть для рейтинга шаг 0.1, а его границы от 7 до 9. На первой итерации поиск будет проходить среди заспийе с рейтингом от 7 до 9, на второй от 6.9 до 9.1, ... , на n-ой от 7-n до 9 + n. Ошибками выхода за минимальное, максимальное значение(отрицательный рейтинг например) можно пренебречь, потому что это ни на что не влияет.
      - Если кол-во итераций превысило `V`, то выходим - рекомендаций подобрать не удалось.
  - Данный алгоритм требует некоторых уточнений:
    - Во первых, как подсчитывать шаг? 
      - При большом значении будут рекомендоваться тайтлы, не отвечающие вкусам пользователя. А если взять малый шаг, то потеряем в производительности. 
      - Разным признакам должен соотвествовать разный шаг. Так, шаг 0.1 отлично подойдет для рейтинга, а вот для года выпуска такое значение почти ничего не изменит.
    - Для решения описанных проблем, для вычисления шага используется следующий подход:
      - Берётся число 's', к нему прибавляется 'd' 'd/n-1' раз
      ```
      func LinearF(s, n, d float64) float64 {
        if n == 0 {
            return 0.01
        }
        var square = s
        for i := d; i <= n; i += d {
            square += i
        }
	    return square
      }
      ```
      В случае если `s = 0, d = 1`, получим обычный сумматор всех чисел чисел от 1 до `n`(для 1 = 1, для 2 = 3, для 3 = 6, для 4 = 10). 
        - Допустим, что `n` в формуле выше - это вес(дальше я буду называть его `weight`). Тогда чем больше вес, тем больше шаг. При `weight` 1 получим шаг(дальше `step`) 1, а при 10 аж 55! Фильтры с наибольшим весом получат наибольший шаг. Получается бред - чем важнее для нас фильтр, тем больше шаг и тем больше лишних тайтлов! Значит `n = weight` - неверно, необходимо брать  `n = 10 - weight` (Считаем, что вес принимает значения от 0 до 10). Отлично, теперь больше вес - меньше шаг. Например, если у всех параметров, кроме года выпуска поставить вес 9, а у года поставить 5, то в рекомендации попадут тайтлы, близкие к исходным по всем параметрам кроме года. Однако если пользователь выставит повсеместно вес 10, то шаг будет 0 и никаких рекомендаций не появится, ведь фильтры не расширятся. Конечно, пользователь сам стреляет себе в ногу, но давайте облегчим ему боль. Для этого установим проверку если `n == 0` <=> `10 - weight == 0`, то `step = 0.01`.
        - Описанный выше способ отлично помогает учитывать веса, но осталась проблема - надо чтобы для разных фильтров можно было генерировать сильно разные шаги(например для одного от 0.01 до 0.1, для другого от 1 до 10). На самом деле это не сложно, надо всего лишь скорректировать подсчёт шага, искуственно понижая или повышая его в K раз. Для этого вводится переменная `denominator`, которая корректирует `weight`. Именно из-за `denominator` приходится вводить переменную `d`, чтобы  инкремент был дробным
        - Оценим значения шага при фиксированных `s = 0, d = 1` и увеличении n: 
          - для 1 -> 1, 
          - для 2 -> 3, 
          - для 3 -> 6, 
          - для 4 -> 10, 
          - для 5 -> 15, 
          - для 6 -> 21, 
          - для 7 -> 28, 
          - для 8 -> 36, 
          - для 9 -> 45, 
          - для 10 -> 55. 

        Рассмотрим `denominator = 50`, мы получим шаг в 50 раз меньше, 1/50, 3/50, 6/50, 10/50, 15/50... 55/50. Если смотреть начиная с 4-го шага, мы видим хорошие шаги, отличные для расширения фильтра оценки тайтла. Но вот до 4-ех шаг крайне маленький. Для этого вводится `s` - стартовое значение. Так, для оценки юзеров это значение равно `0.1`, чтобы искуственно увеличить шаг
    - Уточнение номер 2, а достаточно ли этого шага для расширения?
      - Как я уже говорил, шаг влияет на точность и скорость работы. Благодаря формуле выше, удаётся кастомизировать шаг под свои нужды, то есть сделать его или маленьким для точного подсчёта или большим для подсчёта быстрого. Однако хочется найти золотую середину.       
      Для этого сейчас все шаги специально вычисляются довольно маленькими(если не ставить им малый вес, который заметно повышает шаг). И после каждой `K`-ой операции, шаг умножается на 2! Таким образом получается постепенно ускорять поиск, понижая точность. Я решил выбрать `K = V / 4`, где `V` - количество итераций, после которого будет принять решено, что поиск рекомендаций провалился. 

6. Как учитывается приоритет фильтра при поиске?
- Каждому параметру присваивается некоторый вес, который влияет на то, насколько данный признак влияет на схожесть. По умолчанию установлены следующие веса:
  - Тип тайтла (фильм, сериал, клип и т.д.) - __*1*__
  - Пользовательская оценка (оценка, поставленная пользователями [shikimori](https://shikimori.one/)) - __*1*__
  - Эпизоды (количество серий) - __*3*__
  - ДлительностЬ (хронометраж серии) - __*2*__
  - Возрастной рейтинг (для детей, 13+, 18+, 21+ и т.д.) - __*5*__
  - Год выпуска - __*0.05*__
  - Онгоинг (сезон еще не вышёл на экраны целиком) - __*5*__
  - Студия - __*3*__
  - Жанр - __*10*__
- Чем больше вес у характеристики, тем сильнее разнятся тайтлы с разными вариантами этой характеристики

7. Как изменить веса?
-  Нажмите на кнопку "тонкая настройка", она находится правее кнопки "расширенный поиск". При нажатии появятся ползунки для указания весов по каждому признаку. Изменения применятся автоматически



# Умный ассистент
Ниже приведены сценарии использоавния

## Список действий
- __Узнать возрастной рейтинг__
  - пример запроса:
    - `Эйфория` для детей?
    - На кого рассчитана `Игра Джокера`?
    - Этот тайлт предназначен для подростков?
  - пример ответа
    - Возрастная оценка '`Эйр Гир`': `r_plus`
    - Возрастная оценка '`Яркая Тихая 3`': `pg_13`
  - ключевые слова:
    - *__title_name__* - имя тайтла
  - контекcт:
    - *__title_name__* - имя тайтла
- __Узнать год выпуска__
  - пример запроса:
    - Когда начал выходить сериал `Код гиас`?
    - Назови год выпуска `Электромагнитной подружки`?
    - Когда сняли `историю финала 2`?
  - пример ответа
    - '`История финала 2`' вышло в `2017`
  - ключевые слова:
    - *__title_name__* - имя тайтла
  - контекcт:
    - *__title_name__* - имя тайтла
- __Узнать длительность серии__
  - пример запроса:
    - Сколько идёт `твое имя`?
    - Длитетельность серии `Врат Штейнера`?
    - Сколько времени занимает `серия маги о Винланде`
  - пример ответа
    - '`История финала 2`' вышло в `2017`
  - ключевые слова:
    - *__title_name__* - имя тайтла
  - контекcт:
    - *__title_name__* - имя тайтла
- __Узнать жанры:__
  - пример запроса:
    - Это точно `хоррор`?
    - Какие жанры у `Великолепный парк Амаги`?
    - `Эхо террора` это `триллер`?
  - пример ответа
    - Аниме '`Эхо террора`' относится к жанрам: `Детектив`, `Психологическое`, `Триллер`
  - ключевые слова:
    - *__title_name__* - имя тайтла
    - *__genre__* - жанр
  - контекcт:
    - *__title_name__* - имя тайтла
- __Узнать описание:__
  - пример запроса:
    - Больше подробностей
    - Расскажи про этот сериал
    - Про что `убийца гоблинов`?
  - пример ответа
    - Описание аниме(`Йона на заре`): Йона, единственная принцесса королевства Кока, ведет роскошную и беззаботную жизнь, как и подобает принцессам. У нее есть...
  - ключевые слова:
    - *__title_name__* - имя тайтла
  - контекcт:
    - *__title_name__* - имя тайтла
- __Узнать оценку__:
  - пример запроса:
    - Средняя `оценка` пользователей
    - Какой `средний балл` на шикимори у `Наруто`?
    - Какая `оценка` у `Тетради смерти`?
  - пример ответа
    - `Гинтама` имеет оценку `8.98`/10 баллов на shikimori
  - ключевые слова:
    - *__anime_tag__* - характеристика, которую спрашивает пользователь
  - контекcт:
    - *__title_name__* - имя тайтла
- __Узнать студию производителя__:
  - пример запроса:
    - Кто занимался производством сериала `Вынос гигантов`
    - Какая студия выпустила `Голодное сердце: Дикий бомбардир`
    - Кто снял `Слэм-Данк`
  - пример ответа
    - Аниме `Гинтама` выпущено студией `Sunrise`
  - ключевые слова:
    - *__title_name__* - имя тайтла
  - контекcт:
    - *__title_name__* - имя тайтла
- __Оценить аниме__
  - пример запроса:
    - Не стоит смотреть, это слабая `5`
    - За режиссуру `2/10`
    - Оно мне `не понравилось`
  - пример ответа
    - Надеюсь следующее аниме тебе понравится больше
    - Круто, что тебе зашёл этот тайтл
  - ключевые слова:
    - *__score__* - оценочное суждение
  - контекcт:
    - *__title_name__* - имя тайтла
- __Рекомендация по жанрам и тайтлам__
  - примеры запроса(*Вопросы взяты с форумов по аниме, орфография авторов сохранена*):
    - Посаветуйте посмотреть аниме `романтика` и `комедия`
    - Подскажите аниме похожие на `Ван Пис` и `Хвост феи`
    - пософетуйте аниме `романтику` на подобие"` президент студсовета горничная`"
  - примеры ответов:
    - Тайтлы в жанре '`Романтика`', '`Комедия`': *список тайтлов*
    - Тайтлы похожие на '`Ван-Пис`', '`Хвост Феи`': *список тайтлов*
    - Тайтлы похожие на '`Тетрадь смерти`' в жанре '`хентай`'... В нашей базе данных нет таких тайтлов, попробуй смягчить требования
  - ключевые слова:
    - *__genre__* - жанр
    - *__title_name__* - имя тайтла
- __Рекомендация по моим предпочтениям__
  - примеры запроса:
    - Лучшие тайтлы
    - Найди что посмотреть
    - Что посмотреть?
  - примеры ответов:
    - Мне кажется тебе понравятся вот эти тайтлы: *список аниме*
- __Рекомендация похожего__
  - примеры запроса:
    - Есть на примете что то такое?
    - Порекомендуй что нибудь подобное
    - Есть что нибудь похожее?
  - примеры ответов:
    - Мне кажется тебе понравятся вот эти тайтлы: *список аниме*

